function countSuccess(count) {
    const countElem = document.getElementById('count');

    if (countElem) {
        countElem.style.backgroundColor = '#5865f2';
        countElem.innerText = `SERVER COUNT: ${count}`;
    }
}

function countError() {
    const countElem = document.getElementById('count');

    if (countElem) {
        countElem.style.backgroundColor = '#f23f43';
        countElem.innerText = `ERROR`;
    }
}

window.addEventListener("load", function () {
    const fetchWithTimeout = async (url, options, request, timeout = 3000) => {
        const controller = new AbortController();
        const timeoutError = new Error('Fetch timed out');

        const fetchOptions = {
            ...options,
            headers: {
                'Content-Type': 'application/json',
                ...options.headers
            },
            body: JSON.stringify({ request }),
            signal: controller.signal
        };

        const fetchPromise = fetch(url, fetchOptions);
        const timeoutPromise = new Promise((_, reject) =>
            setTimeout(() => reject(timeoutError), timeout)
        );

        try {
            return await Promise.race([fetchPromise, timeoutPromise]);
        } catch (error) {
            controller.abort();
            throw error;
        }
    };

    fetchWithTimeout('https://rxdev.alwaysdata.net/api', { method: 'POST' }, 'count')
        .then((response) => response.text())
        .then((data) => {
            if (data) {
                countSuccess(data);
            } else {
                countError();
            }
        })
        .catch((e) => countError());

        function pingSuccess() {
    const onlineElem = document.getElementById('online');
    const statusElem = document.getElementById('status');

    if (onlineElem) {
        onlineElem.style.backgroundColor = '#1fb141';
    }

    if (statusElem) {
        statusElem.style.backgroundColor = '#1fb141';
        statusElem.title = 'ONLINE';
    }
}

function pingError() {
    const onlineElem = document.getElementById('online');
    const statusElem = document.getElementById('status');

    if (onlineElem) {
        onlineElem.style.backgroundColor = '#f23f43';
    }

    if (statusElem) {
        statusElem.style.backgroundColor = '#f23f43';
        statusElem.title = 'OFFLINE';
    }
}

window.addEventListener("load", function () {
    const fetchWithTimeout = async (url, options, request, timeout = 3000) => {
        const controller = new AbortController();
        const timeoutError = new Error('Fetch timed out');

        const fetchOptions = {
            ...options,
            headers: {
                'Content-Type': 'application/json',
                ...options.headers
            },
            body: JSON.stringify({ request }),
            signal: controller.signal
        };

        const fetchPromise = fetch(url, fetchOptions);
        const timeoutPromise = new Promise((_, reject) =>
            setTimeout(() => reject(timeoutError), timeout)
        );

        try {
            return await Promise.race([fetchPromise, timeoutPromise]);
        } catch (error) {
            controller.abort();
            throw error;
        }
    };

    fetchWithTimeout('https://rxdev.alwaysdata.net/api', { method: 'POST' }, 'ping')
        .then((response) => response.status)
        .then((data) => {
            if (data === 200) {
                pingSuccess();
            } else {
                pingError();
            }
        })
        .catch((e) => pingError());
})
})
